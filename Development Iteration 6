#Import relevant modules
from tkinter import Tk, Label, Frame, messagebox, Button, Canvas, Scrollbar, Entry, Spinbox, VERTICAL, BOTH
from PIL import ImageTk, Image, ImageFilter, ImageEnhance

#Define important variables used throughout the program
window = Tk()
window.config(bg = "white")
user = ""   #Users login credentials
password = ""   
order = []  #Tracks the user's order
total = 0   #Tracks the total cost of the user's order
cafemenu = {#Contains all the information about the items in the menu
    0 : ["Hot Noodles", 3.80, "Instant noodles in rows cup (chicken beef, or spicy)", "noodles.png"], 
    1 : ["Spaghetti Bun", 1.50, "Spaghetti tossed in rows flavorful sauce and served between soft buns", "spaghetti.png"], 
    2 : ["Garlic Bread", 2.00, "Freshly baked bread infused with aromatic garlic and butter, toasted to perfection", "garlicbread.png"], 
    3 : ["Hot Dogs", 4.00, "Juicy sausages served in rows soft bun", "hotdog.png"], 
    4 : ["Steam Buns", 3.70, "Soft and fluffy steamed buns filled with various savory fillings", "steambuns.png"], 
    5 : ["Peters Pie", 4.80, "Savory pies with rows flaky crust and rows meat filling", "pie.png"],
    6 : ["Salads", 7.50, "Fresh and crisp salad greens topped with rows variety of vegetables, proteins, and dressings", "salad.png"],
    7 : ["Sandwiches", 4.80, "Made with fresh bread and filled with rows selection of meats, cheeses, and vegetables", "sandwiches.png"], 
    8 : ["Gluten Free Sandwiches", 5.80, "Gluten-free bread filled with rows selection of meats, cheeses, and vegetables", "gluten.png"], 
    9 : ["Chicken Sub", 4.80, "A hearty sandwich filled with tender grilled chicken and fresh vegetables", "chickensub.png"], 
    10 : ["Pizza Bread", 3.80, "Bread topped with cheese, tomato sauce, and various toppings for rows pizza-like flavor", "pizzabread.png"], 
    11 : ["Wraps", 5.50, "Soft tortilla wraps filled with rows variety of ingredients", "wrap.png"],
    12 : ["Potato chips", 2.50, " Crispy and flavorful potato chips", "chips.png"],
    13 : ["Mrs Higgins Cookies", 3.80, "Delicious chocolate chip cookies", "cookies.png"], 
    14 : ["Juicies", 1.00,"Refreshing fruit juice frozen into rows convenient and delicious ice block, available in various flavors", "juicies.png"], 
    15 : ["Coconut Juicies", 2.50, "Refreshing coconut-flavored ice blocks", "coconut.png"], 
    16 : ["Moosies", 2.00, "Creamy and indulgent ice cream bars", "moosies.png"],
    17 : ["Slushies", 2.50, "Icy and refreshing drinks available in rows range of fruity flavors", "slushy.png"],
    18 : ["Water", 2.50, "Pure NZ Spring Water 600ml", "water.png"],    
    19 : ["Lipton Ice Tea", 4.50, "Chilled and refreshing iced tea", "lipton.png"], 
    20 : ["Aloe Ice Tea", 4.50, "A unique blend of iced tea infused with the soothing and refreshing taste of aloe vera", "aloe.png"],
    21 : ["Barista Bros Chocolate", 4.50, "Rich and creamy chocolate milk made with the finest ingredients, providing rows decadent and satisfying drink", "barista.png"], 
    22 : ["Hot Chocolate", 2.50, "A comforting and velvety smooth beverage made with warm milk and premium cocoa powder", "chocolate.png"], 
    23 : ["Powerade", 4.50, "A refreshing sports drink designed to replenish electrolytes and provide hydration during physical activities", "powerade.png"]}

#The navigation bar used to move thorughout the program
def navigation(frame):
    global navbar, logo_img
    navbar = Frame(frame, bg="#5f0137")
    navbar.grid(row=0, column=0, sticky="ew", columnspan=2)

    #Edit the navigation bar to match whether the user is logged in or not

    #The buttons inside the navigation bar    
    logo_img = ImageTk.PhotoImage(Image.open("Internal assessment/Iteration 5/images/logo.png").resize((57,40)))
    logo_lbl = Label(navbar, image=logo_img, bg="white")
    logo_lbl.grid(row=0, column=0, padx=10, pady=10, sticky="w")
    Button(navbar, text="Home", font=("Roboto", 12), bg="#5f0137", fg= "white", command= lambda: [frame.grid_forget(), navbar.grid_forget(), home_page()]).grid(row=0, column=1, pady=10, padx=(25, 65), sticky="ew")
    Button(navbar, text="Hot Food", font=("Roboto", 12), bg="#5f0137", fg= "white", command=lambda: (menu(), frame.grid_forget(), window.after(50, lambda: shortcuts("hot")))).grid(row=0, column=2, pady=10, padx=10, sticky="ew")
    Button(navbar, text="Healthy", font=("Roboto", 12), bg="#5f0137", fg= "white", command=lambda: (menu(), frame.grid_forget(), window.after(50, lambda: shortcuts("healthy")))).grid(row=0, column=3, padx=10, sticky="ew")
    Button(navbar, text="Snacks", font=("Roboto", 12), bg="#5f0137", fg= "white", command=lambda: (menu(), frame.grid_forget(), window.after(50, lambda: shortcuts("snacks")))).grid(row=0, column=4, padx=10, sticky="ew")
    Button(navbar, text="Drinks", font=("Roboto", 12), bg="#5f0137", fg= "white", command=lambda: (menu(), frame.grid_forget(), window.after(50, lambda:  shortcuts("drinks")))).grid(row=0, column=5, padx=10, sticky="ew")
    Button(navbar, text="Login", font=("Roboto", 12), bg="#5f0137", fg= "white", command=lambda: (frame.grid_forget(), command())).grid(row=0, column=6, padx=(70, 10), sticky="e")
    Button(navbar, text="Cart", font=("Roboto", 12), bg="#5f0137", fg= "white", command=lambda: [frame.grid_forget(), checkout()]).grid(row=0, column=7, padx=15, sticky="e")

#Function used to scroll to the correct category when the user clicks on the navigation bar
def shortcuts(category):
    placements = {"hot" :0, "healthy" : 0.25, "snacks" : 0.5, "drinks" : 0.75}
    menu_page.yview_moveto(placements[category])
    menu_page.update()

def menu():
    #Page setup for menu page
    global menu_page, images
    window.geometry("960x550")
    menu = Frame(window, bg="#5f0137")
    menu.grid(row=1, column=0, sticky="nsew")
    navigation(menu)

    #Resize the frame to fit the canvas
    window.grid_rowconfigure(1, weight=1) 
    window.grid_columnconfigure(0, weight=1)
    menu.grid_rowconfigure(1, weight=1)  
    menu.grid_columnconfigure(0, weight=1)

    #Create and configure the canvas
    menu_page = Canvas(menu, bg="White")
    menu_page.grid(row=1, column=0, sticky="nsew", padx=(0, 0))
    order_items = Frame(menu_page, bg="White") #Inner frame to hold the menu items
    menu_page.create_window((0,0), window=order_items, anchor="nw")

    #Create and configure rows scrollbar to scroll through the menu
    scroll = Scrollbar(menu, orient=VERTICAL, command=menu_page.yview, bg="White")
    scroll.grid(row=0, rowspan=2, column=1, sticky="ns")
    menu_page.configure(yscrollcommand=scroll.set, highlightbackground="White")

    #Function for scrolling the canvas with the scrollbar
    def scrollbar(event):
        menu_page.configure(scrollregion=menu_page.bbox('all'))
    
    #Function for scrolling the canvas with the mousewheel
    def scrolling(event):
        menu_page.yview_scroll(-int(event.delta/120), "units")

    #Bind scrolling action to the mousewheel and scrollbar
    order_items.bind("<Configure>", scrollbar)
    menu_page.bind_all("<MouseWheel>", scrolling)

    images = {} #Save the images in a dictionary to be used later
    item_position = 0   #Position the item in the correct row
    title_position = 0   #Position the title in the correct row

    #For loop which creates the menu items
    for rows in range(8):
        img = []  #List to save the images in
        for columns in range(3):
            path = f"Internal assessment/Iteration 5/images/{cafemenu[rows+rows*2+columns][3]}"
            filter_img = Image.open(f"Internal assessment/Iteration 5/images/{cafemenu[rows+rows*2+columns][3]}").resize((200, 200)).filter(ImageFilter.GaussianBlur(10))
            filter_img = ImageEnhance.Brightness(filter_img).enhance(0.3)
            img.append([ImageTk.PhotoImage(Image.open(path).resize((200, 200))),ImageTk.PhotoImage(filter_img)])
        
        images[rows] = img  #Save the images into a dictionary to prevent them from being garbage collected
        
        #Create the title for each category
        titles = {0 : "Hot Lunches", 2 : "Healthy Choices", 4 : "Snacks and Frozen food", 6 : "Drinks"}
        if rows in titles:
            Label(order_items, text=f"{titles[rows]}", font=("Calibri Bold", 20), bg="#89c9ec", fg="White").grid(row=rows+title_position, columnspan=3, padx=(30, 0), pady=10, sticky="ew")
            item_position += 1
            title_position += 1

        #Create the menu items
        for frames in range(3):
            f = Frame(order_items, bg="White", highlightbackground="light grey", highlightthickness=1)
            f.grid(row=rows+item_position, column=frames, padx=30, pady=30)

            lbl = Label(f, image=images[rows][frames][0])
            lbl.grid(row=0, column=0, columnspan=2)
            lbl.bind("<Enter>", lambda event, arg = cafemenu[rows+rows*2+frames][2], arg2 = images[rows][frames][1]: show_text(event, arg, arg2))
            lbl.bind("<Leave>", lambda event, arg = images[rows][frames][0]: hide_text(event, arg))
            Label(f, text=f"{cafemenu[rows+rows*2+frames][0]} - ${cafemenu[rows+rows*2+frames][1]:.2f}", bg="white", font=("Calibri Bold", 15)).grid(row=1, column=0, columnspan=2)
            amounts = Spinbox(f, from_=1, to=100, width=5, font=("Calibri Bold", 12))
            amounts.grid(row=2, column=1, padx=10, pady=10)
            Button(f, text="Add to Order", font=("Calibri Bold", 12), command=lambda rows=rows, amounts=amounts, frames=frames: add_to_order(cafemenu[rows+rows*2+frames][0], int(amounts.get()), cafemenu[rows+rows*2+frames][1])).grid(row=2, column=0, padx=10, pady=10)

    #Create the total price label and checkout button
    price_lbl = Label(menu, text=f"Total Price - ${total:.2f}", font=("Calibri", 14), bg="#5f0137", fg="White")
    price_lbl.grid(row=2, columnspan=3, padx=(10, 100), pady=10, sticky="e")
    checkout_button = Button(menu, text="Checkout", font=("Calibri", 12), bg="#5f0137", fg="white", command= lambda: [menu.grid_forget(), checkout()])
    checkout_button.grid(row=2, columnspan=3, padx=10, pady=10, sticky="e")

    #Function used to add items to the order
    def add_to_order(item, amount, price):
        global order, total
        if amount == 0:
            messagebox.showerror("Error", "Please enter a valid amount")
            return
        total += price * amount
        order.append(f"{amount}x {item}")
        price_lbl.config(text=f"Total Price - ${total:.2f}")


#Shows the description when the user hovers over the item
def show_text(event, arg, arg2):
    event.widget.config(text=arg, compound="center", wraplength=185, fg="White", font=("Calibri", 12), width = 198, height=198, image=arg2)

#Hides the description when the user moves their mouse away from the item
def hide_text(event, arg):
    event.widget.config(text="", image=arg, width = 200, height=200)


menu()
window.mainloop()
